# 9.1 개요

실행 계획을 이해할 수 있어야만 실행 계획의 불합리한 부분을 찾아내고, 더 최적화된 방법으로 실행 계획을 수립하도록 유도할 수 있다.

## 9.1.1 쿼리 실행 절차

1. SQL 파싱: 사용자로부터 요청된 SQL 문장을 잘게 쪼개서 MySQL 서버가 이해할 수 있는 수준으로 분리(파스 트리)한다.
2. 최적화 및 계획 수립: SQL의 파싱 정보(파스 트리)를 확인하면서 어떤 테이블부터 읽고 어떤 인덱스를 이용해 테이블을 읽을지 선택한다.
  - 불필요한 조건 제거 및 복잡한 연산의 단순화
  - 여러 테이블의 조인이 있는 경우 어떤 순서로 테이블을 읽을지 결정
  - 각 테이블에 사용된 조건과 인덱스 통계 정보를 이용해 사용할 인덱스를 결정
  - 가져온 레코드들을 임시 테이블에 넣고 다시 한번 가공해야 하는지 결정
3. 두 번째 단계에서 결정된 테이블의 읽기 순서나 선택된 인덱스를 이용해 스토리지 엔진으로부터 데이터를 가져온다.

## 9.1.2 옵티마이저의 종류

옵티마이저는 비용 기반 최적화(Cost-based optimizer, CBO) 방법과 규칙 기반 최적화 방법(Rule-based optimizer, RBO)으로 크게 나눈다.

- 규칙 기반 최적화
  - 대상 테이블의 레코드 건수나 선택도 등을 고려하지 않고 옵티마이저에 내장된 우선순위에 따라 실행 계획 수립
  - 규칙 기반의 최적화는 이미 오래전부터 많은 DBMS에서 거의 사용되지 않음
- 비용 기반 최적화
  - 쿼리 처리를 위해 여러 방법을 만들고 각 단위 작업의 비용 정보와 대상 테이블의 예측된 통계 정보를 이용해 실행 계획별 비용을 산출

규칙 기반 최적화는 인덱스 통계 정보가 거의 없고 상대적으로 늘니 CPU 연산 탓에 비용 계산 과정이 부담스럽다는 이유로 사용되던 최적화 방법이다.

현재는 대부분의 RDBMS가 비용 기반의 옵티마이저를 채택하고 있으며 MySQL도 마찬가지다.

