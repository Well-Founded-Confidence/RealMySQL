# 8.6 함수 기반 인덱스

MySQL 8.0부터 **컬럼의 값을 변형해서 만들어진 값에 대해 인덱스를 구축**하는 함수 기반 인덱스를 지원하기 시작했다.

- 가상 컬럼을 이용한 인덱스
- 함수를 이용한 인덱스

인덱스 계산 과정 차이만 있지, 실제 내부 구조는 B-Tree이다.

## 8.6.1 가상 컬럼을 이용한 인덱스

8버전부터 가상 컬럼을 추가하고 그 가상 컬럼에 인덱스를 생성할 수 있게 됐다.

```mysql
ALTER TABLE user
  ADD full_name VARCHAR(30) AS (CONCAT(first_name, ' ', last_name)) VIRTUAL,
  ADD INDEX ix_fullname (full_name);
```

가상 컬럼이 VIRTUAL이나 STORED 옵션 중 어떤 옵션으로 생성됐든 관계없이 해당 가상 컬럼에 인덱스를 생성할 수 있다.

하지만, 가상 컬럼은 테이블에 새로운 컬럼을 추가하는 것과 같은 효과를 내기 때문에 실제 테이블의 구조가 변경된다는 단점이 있다.

## 8.6.2 함수를 이용한 인덱스

5.7에서도 가상 컬럼을 사용할 수 있었으나, 직접 인덱스 생성 구문에 사용할 수는 없었다.

```mysql
CREATE TABLE user {
  ... 생략
  INDEX ix_fullname ((CONCAT(firat_name, ' ', last_name)))
};
```

함수를 직접 사용하는 인덱스는 테이블 구조는 변경하지 않고, 계산된 결괏값의 검색을 빠르게 만들어준다.

함수 기반 인덱스를 제대로 활용하려면 반드시 조건절에 함수 기반 인덱스에 명시된 표현식이 그대로 사용돼야 한다.

