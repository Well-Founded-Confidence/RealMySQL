[5.1.1 MySQL에서의 트랜잭션](#511-mysql에서의-트랜잭션)

[5.1.2 주의사항](#512-주의사항)

# 5.1.1 MySQL에서의 트랜잭션
> 하나의 논리적인 작업 세트가 모두 적용되거나 1도 적용된 것이 없음을 보장한다.
- MyISAM vs InnoDB
    - ```sql
        insert into table(pk) values (1),(2),(3)
        -- 테이블에 pk=3인 row가 있다고 가정 => pk 중복 오류 발생
        -- MyISAM은 insert했던 1, 2가 그대로 남아있다.
        -- InnoDB는 insert했던 1, 2가 제거된다.
        ```

# 5.1.2 주의사항
- 프로그램 코드에서 트랜잭션 범위를 최소화하는 것이 좋다.
- ex) 사용자가 게시판에 게시물을 작성한 후 저장 버튼을 클릭했을 때 서버에서 처리하는 내용
    - ```
        1) 처리 시작
            - 데이터베이스 커넥션 생성
            - 트랜잭션 시작
        2) 사용자의 로그인 여부 확인
        3) 사용자의 글쓰기 내용의 오류 여부 확인
        4) 첨부로 업로드된 파일 확인 및 저장
        5) 사용자의 입력 내용을 DBMS에 저장
        6) 첨부 파일 정보를 DBMS에 저장
        7) 저장된 내용 또는 기타 정보를 DBMS에서 조회
        8) 게시물 등록에 대한 알림 메일 발송
        9) 알림 메일 발송 이력을 DBMS에 저장
            - 트랜잭션 종료 (commit)
            - 데이터베이스 커넥션 반납
        10) 처리 완료
        ```
    - DB 커넥션은 갯수가 제한적이므로 각 단위 프로그램이 커넥션을 소유하는 시간이 길어질 수록 사용 가능한 여유 커넥션의 개수는 줄어들 것이다.
    - 8번 작업처러 메일 전송과 같은 외부 서버를 이용하는 경우는 어떻게든 DBMS 트랜잭션에서 제거하는 것이 좋다.
    - 이 처리 절차에는 DBMS 작업이 크게 4개가 있다.
        - 사용자가 입력한 정보를 저장하는 5, 6번 작업은 반드시 하나의 트랜잭션으로 묶어야 한다.
        - 7번 작업은 저장된 데이터의 단순 확인 및 조회이므로 트랜잭션에 포함할 필요는 없다.
        - 9번 작업은 조금 성격이 다르기 때문에 별도의 트랜잭션으로 분리하는 것이 좋다.
        - 7번 작업은 단순 조회라고 본다면 별도로 트랜잭션을 사용하지 않아도 된다.
    - ```
        1) 처리 시작
        2) 사용자의 로그인 여부 확인
        3) 사용자의 글쓰기 내용의 오류 여부 확인
        4) 첨부로 업로드된 파일 확인 및 저장
            - 데이터베이스 커넥션 생성
            - 트랜잭션 시작
        5) 사용자의 입력 내용을 DBMS에 저장
        6) 첨부 파일 정보를 DBMS에 저장
            - 트랜잭션 종료
        7) 저장된 내용 또는 기타 정보를 DBMS에서 조회
        8) 게시물 등록에 대한 알림 메일 발송
            - 트랜잭션 시작
        9) 알림 메일 발송 이력을 DBMS에 저장
            - 트랜잭션 종료 (commit)
            - 데이터베이스 커넥션 반납
        10) 처리 완료
        ```
