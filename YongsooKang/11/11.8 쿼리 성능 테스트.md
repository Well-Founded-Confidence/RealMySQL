## 쿼리의 성능에 영향을 미치는 요소
### 운영체제의 캐시
- MySQL 서버는 운영체제의 파일 시스템 관련 기능을 이용해 데이터 파일을 읽어온다.
- 대부분의 운영체제는 한번 읽은 데이터는 운영체제가 관리하는 별도의 캐시 영역에 보관했다가 동일한 데이터가 요청되면 디스크를 거치지 않고 캐시의 내용을 반환한다.
	- InnoDB 스토리지 엔진은 파일 시스템의 캐시나 버퍼를 거치지 않는 Direct I/O를 사용하므로 성능의 큰 차이는 없음
	- MyISAM 스토리지 엔진은 캐시에 대한 의존도가 높아서 운영체제의 캐시에 따라 성능의 차이가 큰 편이다.
- 운영체제가 관리하는 캐시나 버퍼는 공용 공간이기 때문에 응용 프로그램이 종료되어도 남아있을 수 있음
	- 운영체제가 갖고있는 캐시나 버퍼가 전혀 없는 상태에서 쿼리의 성능을 테스트하려면 운영체제의 캐시 삭제명령을 실행하고 테스트하는 것이 좋음
		```sql
			-- 캐시나 버퍼의 내용을 디스크와 동기화한다.
			sync

			-- 운영체제에 포함된 캐시의 내용을 초기화한다.
			echo 3 > /proc/sys/vm/drop_caches
		```

### MySQL 서버의 버퍼 풀(InnoDB 버퍼 풀과 MyISAM의 키 캐시)
- MySQL 서버는 데이터 파일의 내용을 페이지(or 블록)단위로 캐시하는 기능을 제공한다.
	- InnoDB 스토리지 엔진이 관리하는 캐시: 버퍼 풀
	- MyISAM 스토리지 엔진이 관리하는 캐시: 키 캐시
- InnoDB 버퍼 풀은 인덱스, 데이터 페이지를 캐시하며, 쓰기 작업을 위한 버퍼링 작업까지 겸해서 처리한다.
- MySQL 서버가 한번 시작되면 InnoDB 버퍼 풀과 MyISAM의 키 캐시의 내용을 강제로 삭제할 수 있는 방법이 없다.
	- MySQL 서버에 포함된 키 캐시나 버퍼 풀을 초기화하려면 MySQL 서버를 재시작해야 한다.

### 독립된 MySQL 서버
- MySQL 서버가 기동중인 장비에 웹 서버나 다른 배치용 프로그램이 실행되고 있다면 테스트하려는 쿼리의 성능이 영향을 받게 될 것이다.
- MySQL 서버뿐 아니라 테스트 쿼리를 실행하는 클라이언트 프로그램이나 네트워크의 영향 요소도 고려해야 한다.

#### 쿼리 테스트 횟수
- 실제 쿼리의 성능 테스트를 MySQL 서버의 상태가 워밍업된 상태/콜드 상태에서 진행할지 고려해야 한다.
	- 워밍업된 상태: 캐시나 버퍼에 데이터가 저장된 상태
	- 콜드 상태: 캐시나 버퍼가 모두 초기화된 상태
- 일반적으로 쿼리의 성능 테스트는 워밍업된 상태를 가정하고 테스트함
	- 어느정도 사용량이 있는 서비스라면 콜드 -> 워밍업 상태로 전환하는데 많은 시간이 걸리지 않음
	- 간단한 쿼리의 성능 비교 테스트는 특별히 영향을 미칠만한 프로세스나 다른 쿼리가 실행되고 있는지 확인한 후에 진행하는 것이 좋음
- 운영체제의 캐시, MySQL의 버퍼 풀, 키 캐시는 크기가 제한적이라서 쿼리에서 필요로 하는 데이터나 인덱스 페이지보다 크기가 작으면 플러시, 캐시 작업이 반복해서 발생하므로 쿼리를 한번 실행해서 나온 결과를 그대로 신뢰하면 안된다.
	- 여러번 반복한 후에 나온 결과의 평균을 기준으로 비교하는 것이 좋음
