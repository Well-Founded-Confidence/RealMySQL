## SRS (Spatial Reference System)
- SRS는 GCS, PCS로 구분된다.
  - SRS: 좌표계 / GCS: 지리 좌표계 / PCS: 투영 좌표계
- MySQL 서버에서 지원하는 SRS에 대한 정보는 information_schema DB의 `ST_SPATIAL_REFERENCE_SYSTEMS` 테이블을 통해 확인할 수 있다.
  ![img](./img/st_spatial_reference_systems.png)
  - SRS_ID: 해당 좌표계를 지칭하는 고유 번호
  - DEFINITION: 해당 좌표계가 어떤 좌표계인지에 대한 정의

![img](./img/srs_id_4326.png)
- 지리 좌표계 (GCS)
- AXIS: 레코드에 두번 표시
  - POINT(위도 경도) 순으로 명시해야 함
  - ST_X(): 위도 값을 반환
  - ST_Y(): 경도 값을 반환

![img](./img/srs_id_3857.png)
- 웹 페이지에서 지도를 보여주기 위해 사용되는 투영 좌표계 (PCS)
- `AXIS["X", EAST], AXIS["Y", NORTH]` => POINT(경도 위도) 순으로 명시해야 함
- MySQL 8.0부터 SRID의 지원이 추가됨
  - 지금까지 별도로 SRID를 지정하지 않았던 데이터는 모두 `SRID=0`인 평면 좌표계로 인식될 것
  - 공간데이터 정의 시에 별도로 SRID를 지정하지 않으면 SRID는 0으로 자동인식됨

```sql
  -- 평면 좌표계를 사용하는 공간 데이터
  select st_distance(ST_PointFromText('POINT(0 0)', 0),
                     ST_PointFromText('POINT(1 1)', 0)) as distance;

  -- 웹 기반 지도 좌표계를 사용하는 공간 데이터
  select st_distance(ST_PointFromText('POINT(0 0)', 3857),
                     ST_PointFromText('POINT(1 1)', 3857)) as distance;

  -- WGS 84 지리 좌표계를 사용하는 공간 데이터
  select st_distance(ST_PointFromText('POINT(0 0)', 4326),
                     ST_PointFromText('POINT(1 1)', 4326)) as distance;
```
- ST_PointFromText: MySQL 서버의 공간 데이터를 생성하는 함수
  - param1: 점의 위치
  - param2: param1에 명시된 점이 사용하는 SRS의 SRID 값
- 1: SRID가 0이므로 결과는 단순 좌표 계산 값
- 2: 지구 구체에 대한 고려 없이 평면에서의 거리를 계산하므로 결과는 1과 동일
- 3: 지리 좌표계를 사용하므로 지구 구체 기반이라 다른 계산 값이 나옴
- 공간 데이터 자체가 SRS에 대한 정보를 가지게 되면 MySQL 서버에서 제공되는 공간 함수들을 이용해서 필요한 값을 즉시 계산할 수 있음
  - SRID가 없거나 0인 경우에는 MySQL 서버의 공간 함수들이 데이터의 SRID를 알 수 없기 때문에 기대하는 값이 나오지 않을 수 있음

## 투영 좌표계와 평면 좌표계
- 투영 좌표계: 지구 구체 전체/일부를 평면으로 투영해서 표현한 좌표계
  - `SRID = 0`인 좌표계는 평면 좌표계라고 한다.
    - 단위를 가지지 않고, (X, Y)축의 제한이 없어서 무한 평면 좌표계라고도 함
    - `SRID = 3857`인 투영 좌표계와 단위, 최대, 최솟값을 제외하면 거의 차이가 없음

![img](./img/12.1%20평면%20좌표계와%20투영%20좌표계.png)
- MySQL 서버에서 SRID를 지정하지 않으면 기본값인 0을 가진다.
- 평면 좌표계와 투영 좌표계에서 거리 계산은 피타고라스 공식에 의해 거리가 계산된다.
  - 지구 구체에 대한 고려는 없음
- 투영 좌표계의 두 점 간의 거리는 투영 좌표계의 단위에 따라 결정된다.
  - ex. `SRID = 3857`에서 계산된 거리는 meter 값이다.

```sql
  -- 평면 좌표계 사용
  create table plain_coord (
    id int not null auto_increment,
    location point srid 0,
    primary key(id)
  );

  -- 투영 좌표계 사용
  create table projection_coord (
    id int not null auto_increment,
    location point srid 3857,
    primary key(id)
  );
```
- 각 테이블을 생성하면서 srid를 지정하여 평면/투영 좌표계를 사용하는 공간 데이터라는 것을 명시적으로 선언
- srid가 정의된 컬럼에 srid이 다른 공간 데이터를 저장하려고 하면 `SRID가 일치하지 않는다`는 에러가 발생한다.
  ![img](./img/match_srid_exception.png)
- 테이블을 생성할 때 srid를 명시하지 않았다면 해당 컬럼은 모든 srid를 저장할 수 있다.
  - 하나의 컬럼에 저장된 데이터의 srid가 제각각이라면 MySQL 서버는 인덱스를 이용한 빠른 검색을 수행할 수 없게 된다.
  - varchar 타입의 컬럼에 여러 콜레이션을 섞어서 저장한 것과 같은 결과를 만들 것이다.

![img](./img/평면%20좌표계%20조회.png)
![img](./img/투영%20좌표계%20조회.png)
- `ST_AsWKB()` 함수의 결괏값이 WKB(Well Known Binary) 포맷의 공간 데이터
- MySQL 서버의 내부 이진 포맷이나 WKB 포맷으로 출력된 데이터는 눈으로 식별하기 어려움
  - `ST_AsText()` 함수를 이용해서 이진 데이터를 WKT 포맷으로 변환해서 보여줌
- 특정 공간 데이터가 어떤 SRID를 사용하는지는 `ST_SRID()` 함수를 이용하여 확인한다.
  ```sql
    select ST_SRID(ST_PointFromText('POINT(5 5)', 0));
    select ST_SRID(ST_PointFromText('POINT(14133793.435554 4494917.464846)', 3857));
  ```
  - 평면/투영 좌표계에서는 단순 피타고리스 정리에 의한 결과가 보인다.
  - 계산된 거리 값은 지구 구체상의 실제 거리와는 오차가 있다.
  - 지구상의 두 점 간의 거리를 계산하기 위해서는 `ST_Distance_Sphere()` 함수를 사용한다.
    - `SRID=4326`과 같은 지리 좌표에만 사용할 수 있어서 평면/투영 좌표계를 사용하는 좌표 간의 거리 계산에는 사용할 수 없다.
